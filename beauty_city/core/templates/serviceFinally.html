{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Beauty City - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" integrity="sha512-17EgCFERpgZKcm0j0fEq1YCJuyAWdz9KUtv1EjVuaOz8pDnh/0nZxmU6BBXwaaxqoi9PQXnRWqlcDB027hgv9A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="{% static 'css/jquery.arcticmodal-0.3.css' %}">
	<link rel="stylesheet" href="{% static 'css/simple.css' %}">
	<link rel="stylesheet" href="{% static 'css/bootstrap-grid.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/air-datepicker.css' %}">
	<link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
	<section id="mobMenu">
		<div class="mobMenu">
			<div class="container">
			<div class="mobMenu__header">
				<div class="row">
					<div class="col-4 col-md-3">
						<a href="/">
							<img src="{% static 'img/Logo.svg' %}" alt="Logo" class="logo header__logo">
						</a>
					</div>
					<div class="col-3 col-md-2">
						<img src="{% static 'img/x.svg' %}" alt="x" class="mobMenuClose">
					</div>
				</div>
			</div>
			<div class="mobMenu__content">
				<div class="row">
					<div class="col-md-3">
						<nav>
							<ul class="mobMenu__menu">
								<li class="mobMenu__menu_item">
									<a href="#" class="mobMenu__menu_link">–ú–∞—Å—Ç–µ—Ä–∞</a>
								</li>
								<li class="mobMenu__menu_item"><a href="#" class="mobMenu__menu_link">–£—Å–ª—É–≥–∏</a></li>
								<li class="mobMenu__menu_item"><a href="#" class="mobMenu__menu_link">–û—Ç–∑—ã–≤—ã</a></li>
								<li class="mobMenu__menu_item"><a href="#" class="mobMenu__menu_link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
							</ul>
						</nav>
						<a href="#" class="mobMenu__account">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<a href="#contacts" class="mobMenu__btn">–ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç–µ –º–Ω–µ</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	</section>
	<header id="header">
		<div class="container">
			<div class="header">
				<div class="row">
					<div class="col-2 col-md-2 mob">
						<img src="{% static 'img/hamburger.svg' %}" alt="hamburger" class="header__mobMenu">
					</div>
					<div class="col-5 col-md-3 col-lg-2">
						<a href="/">
							<img src="{% static 'img/Logo.svg' %}" alt="Logo" class="logo header__logo">
						</a>
					</div>
					<div class="col-md-5 ">
						<nav>
						<ul class="menu">
							<li class="menu__item"><a href="#" class="menu__item_link">–ú–∞—Å—Ç–µ—Ä–∞</a></li>
							<li class="menu__item"><a href="#" class="menu__item_link">–£—Å–ª—É–≥–∏</a></li>
							<li class="menu__item"><a href="#" class="menu__item_link">–û—Ç–∑—ã–≤—ã</a></li>
							<li class="menu__item"><a href="#" class="menu__item_link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
						</ul>
					</nav>
					</div>
					<div class="col-2 col-md-2 col-lg-3">
						<div class="header__block">
						<button class="header__block_btn">–ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç–µ –º–Ω–µ</button>
						<div class="header__block_auth">
							<img src="{% static 'img/acc.svg' %}" alt="account" class="header__account_img">
							<span class="header__block_auth__intro">–í–æ–π—Ç–∏</span>
						</div>
					</div>
					</div>
				</div>
			</div>
		</div>
	</header>

	<section id="serviceFinally">
		<div class="container">
			<div class="serviceFinally">
				{% if error %}
					<div class="error-alert" style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
						‚ö†Ô∏è {{ error }}
						<a href="{% url 'service' %}" style="display: block; margin-top: 10px;">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–±–æ—Ä—É —É—Å–ª—É–≥–∏</a>
					</div>
				{% endif %}

				<div class="row">
					<div class="col-md-7 col-lg-7">
						<div class="breadCrumbs">
							<a href="{% url 'index' %}" class="breadCrumbs__item">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a> /
							<a href="{% url 'service' %}" class="breadCrumbs__item">–í—ã–±–æ—Ä —É—Å–ª—É–≥–∏</a>
						</div>

						<div class="service__block">
							<h1 class="service__title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h1>
						</div>

						<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö -->
						{% if selected_salon and selected_procedure and selected_specialist %}
							<form method="POST"
								  action="{% url 'service_finally' %}?salon={{ selected_salon.id }}&procedure={{ selected_procedure.id }}&specialist={{ selected_specialist.id }}&date={{ selected_date }}&time={{ selected_time }}"
								  class="serviceFinally__form">
								{% csrf_token %}

								<div class="serviceFinally__form_block">
									<div class="serviceFinally__form_header fic">
										<span class="serviceFinally__form_header__number">–ó–∞–ø–∏—Å—å –Ω–∞ —É—Å–ª—É–≥—É</span>
										<div class="serviceFinally__form_header__item fic">
											<div class="serviceFinally__form_header__service">{{ selected_salon.name }}</div>
											<div class="serviceFinally__form_header__address">{{ selected_salon.address }}</div>
										</div>
									</div>
									<div class="serviceFinally__form_content">
										<!-- –£—Å–ª—É–≥–∞ -->
										<div class="serviceFinally__form_content__block fic">
											<div class="serviceFinally__form_content__title">{{ selected_procedure.title }}</div>
											<div class="serviceFinally__form_content__price" id="original-price">{{ selected_procedure.base_price }} ‚ÇΩ</div>
										</div>
										<!-- –ú–∞—Å—Ç–µ—Ä, –¥–∞—Ç–∞, –≤—Ä–µ–º—è -->
										<div class="serviceFinally__form_content__block fic">
											<div class="serviceFinally__form_content__items fic">
												{% if selected_specialist.photo %}
													<img src="{{ selected_specialist.photo.url }}" alt="avatar" class="accordion__block_img">
												{% endif %}
												<div class="accordion__block_master">{{ selected_specialist.full_name }}</div>
											</div>
											<div class="serviceFinally__form_content__item fic">
												<div class="serviceFinally__form_content__time">{{ selected_time }}</div>
												<div class="serviceFinally__form_content__date">{{ selected_date }}</div>
											</div>
										</div>
										<!-- –ü–æ–ª–µ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ -->
										<div class="serviceFinally__form_content__block fic">
											<div class="serviceFinally__form_content__title">–ü—Ä–æ–º–æ–∫–æ–¥</div>
											<input type="text"
												   id="promo-input-final"
												   name="promo_code"
												   placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥"
												   class="service__form_input">
											<div id="promo-result-final" class="promo-result"></div>
										</div>

										<!-- –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ -->
										<div class="serviceFinally__form_content__block fic">
											<div class="serviceFinally__form_content__title">–ò—Ç–æ–≥–æ</div>
											<div class="serviceFinally__form_content__price" id="final-price">{{ selected_procedure.base_price }} ‚ÇΩ</div>
										</div>
									</div>
								</div>

								<!-- –§–æ—Ä–º–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
								<div class="serviceFinally__form_items">
									<!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã -->
									<input type="hidden" name="salon" value="{{ selected_salon.id }}">
									<input type="hidden" name="procedure" value="{{ selected_procedure.id }}">
									<input type="hidden" name="specialist" value="{{ selected_specialist.id }}">

									<div class="contacts__form_block fic">
										<!-- –ò–º—è -->
										<input type="text"
											   name="customer_name"
											   class="contacts__form_input"
											   placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
											   value="{{ form.customer_name.value|default_if_none:'' }}"
											   required>
										<!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
										<div class="contacts__form_inputBlock">
											<input type="text"
												   name="phone"
												   class="contacts__form_input"
												   placeholder="+7(999)999-99-99"
												   value="{{ form.phone.value|default_if_none:'' }}"
												   required>
										</div>
									</div>

									<!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
									<textarea name="question" class="contacts__form_textarea" placeholder="–í–æ–ø—Ä–æ—Å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">{{ form.question.value|default_if_none:'' }}</textarea>

									<!-- –°–æ–≥–ª–∞—Å–∏–µ -->
									<div class="contacts__form_checkboxBlock fic">
										<input type="checkbox" id="privacyPolicy" class="contacts__form_checkbox" required>
										<span class="contacts__form_checkboxBlock__intro">
											–Ø —Å–æ–≥–ª–∞—Å–µ–Ω(–∞) —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
										</span>
									</div>

									<!-- –ö–Ω–æ–ø–∫–∏ -->
									<button type="submit" class="serviceFinally__form_btn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∏ –æ–ø–ª–∞—Ç–∏—Ç—å</button>
									<a href="{% url 'service' %}" class="serviceFinally__form_back">–ù–∞–∑–∞–¥</a>
								</div>
							</form>
						{% else %}
							<div style="background: #fff3cd; color: #856404; padding: 20px; border-radius: 5px; margin: 20px 0;">
								‚ö†Ô∏è –ù–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–±—Ä–∞–Ω—ã.
								<a href="{% url 'service' %}" style="display: block; margin-top: 10px;">–í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –≤—ã–±–æ—Ä—É —É—Å–ª—É–≥–∏</a>
							</div>
						{% endif %}
					</div>

					<div class="col-md-12 col-lg-5">
						<!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
						<div class="info-sidebar">
							<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–ª–æ–Ω–µ -->
							{% if selected_salon %}
								<div style="background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
									<h4 style="margin-bottom: 15px;">üìç –ê–¥—Ä–µ—Å —Å–∞–ª–æ–Ω–∞</h4>
									<p>{{ selected_salon.address }}</p>
									{% if selected_salon.phone %}
										<p style="color: #28a745;">üìû {{ selected_salon.phone }}</p>
									{% endif %}
								</div>
							{% endif %}

							<!-- –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
							<div style="background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
								<h4 style="margin-bottom: 15px;">üí° –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å</h4>
								<ul style="padding-left: 20px;">
									<li style="margin-bottom: 10px;">–ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ –∑–∞–ø–∏—Å–∏</li>
									<li style="margin-bottom: 10px;">–û—Ç–º–µ–Ω–∞ –∑–∞ 24 —á–∞—Å–∞ - –ø–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç</li>
									<li>–ü—Ä–∏ –æ–ø–æ–∑–¥–∞–Ω–∏–∏ –±–æ–ª–µ–µ 15 –º–∏–Ω—É—Ç –∑–∞–ø–∏—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–∞</li>
								</ul>
							</div>

							<!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ -->
							<div style="background: #e3f2fd; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
								<h4 style="margin-bottom: 15px;">‚ùì –í–æ–ø—Ä–æ—Å—ã?</h4>
								<p>–ó–≤–æ–Ω–∏—Ç–µ:</p>
								{% if settings and settings.manager_phone %}
									<a href="tel:{{ settings.manager_phone }}"
									   style="display: inline-block; background: #17a2b8; color: white; padding: 10px 15px; border-radius: 5px; text-decoration: none; margin: 10px 0;">
										üìû {{ settings.manager_phone_pretty|default:settings.manager_phone }}
									</a>
								{% endif %}
							</div>

							<!-- –ë–∞–Ω–Ω–µ—Ä -->
							<img src="{% static 'img/bannerImg.svg' %}" alt="bannerImg" class="banner__img">
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<footer id="footer">
		<div class="container">
			<div class="footer">
				<div class="footer__block">
					<div class="row">
						<div class="col-md-3 col-lg-2">
							<a href="/"><img src="{% static 'img/Logo.svg' %}" alt="logo" class="footer__logo"></a>
						</div>
						<div class="col-md-5 minMobHide">
							<nav>
								<ul class="menu">
									<li class="menu__item"><a href="#" class="menu__item_link">–ú–∞—Å—Ç–µ—Ä–∞</a></li>
									<li class="menu__item"><a href="#" class="menu__item_link">–£—Å–ª—É–≥–∏</a></li>
									<li class="menu__item"><a href="#" class="menu__item_link">–û—Ç–∑—ã–≤—ã</a></li>
									<li class="menu__item"><a href="#" class="menu__item_link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
								</ul>
							</nav>
						</div>
					</div>
					<div class="footer__contact">
						<div class="row">
							<div class="col-md-4">
								<div class="footer__data">—Å 10:00 –¥–æ 20:00 –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö</div>
							</div>
							<div class="col-md-3">
								{% if settings and settings.manager_phone %}
									<a href="tel:{{ settings.manager_phone }}" class="contacts__info_tel">{{ settings.manager_phone_pretty|default:settings.manager_phone }}</a>
								{% endif %}
							</div>
						</div>
						<div class="row">
							<div class="col-md-5 minMobShow">
								<nav>
									<ul class="menu">
										<li class="menu__item"><a href="#" class="menu__item_link">–ú–∞—Å—Ç–µ—Ä–∞</a></li>
										<li class="menu__item"><a href="#" class="menu__item_link">–£—Å–ª—É–≥–∏</a></li>
										<li class="menu__item"><a href="#" class="menu__item_link">–û—Ç–∑—ã–≤—ã</a></li>
										<li class="menu__item"><a href="#" class="menu__item_link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
									</ul>
								</nav>
							</div>
						</div>
					</div>
					<hr class="hr">
					<div class="footer__bottom">
						<div class="row">
							<div class="col-md-4 col-lg-3">
								<a href="#" class="footer__link">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
							</div>
							<div class="col-md-3">
								<div class="footer__copy">2022. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</div>
							</div>
							<div class="col-md-3 col-lg-2">
								<div class="footer__social fic">
									<a href=""><img src="{% static 'img/waGray.svg' %}" alt="wa" class="contacts__social_icon"></a>
									<a href=""><img src="{% static 'img/vkGray.svg' %}" alt="vk" class="contacts__social_icon"></a>
									<a href=""><img src="{% static 'img/tgGray.svg' %}" alt="tg" class="contacts__social_icon"></a>
									<a href=""><img src="{% static 'img/instaGray.svg' %}" alt="insta" class="contacts__social_icon"></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>

	<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã) -->
	<div style="display: none;">
		<div class="box-modal authPopup popup" id="authModal">
			<div class="box-modal_close arcticmodal-close"><img src="{% static 'img/x.svg' %}" alt="x"></div>
			<div class="popup__title authPopup__title">–í–æ–π—Ç–∏ –ø–æ –∫–æ–¥—É</div>
			<p class="popup__text authPopup__text">–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –º—ã –≤—ã—à–ª–µ–º –Ω–∞ –Ω–µ–≥–æ –∫–æ–¥</p>
			<form action="#" class="authPopup__form">
				<div class="contacts__form_inputBlock">
					<input type="text" name="tel" class="contacts__form_input" placeholder="+7(999)999-99-99" required>
				</div>
				<div class="contacts__form_checkboxBlock fic">
					<input type="checkbox" class="contacts__form_checkbox" checked>
					<span class="contacts__form_checkboxBlock__intro">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω(–∞) —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
				</div>
				<button type="submit" class="popup__btn authPopup__btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
			</form>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js" integrity="sha512-XtmMtDEcNz2j7ekrtHvOVR4iwwaD6o/FUJe6+Zq+HgcCsk3kj4uSQQR8weQ2QVj1o0Pk6PwYLohm206ZzNfubg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="{% static 'js/jquery.arcticmodal-0.3.min.js' %}"></script>
	<script src="{% static 'js/main.js' %}"></script>

	<script>
	// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
	let originalPrice = {{ selected_procedure.base_price|default:"0" }};
	let finalPrice = originalPrice;
	let promoCode = '';

	// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
	async function checkPromoFinal() {
		const code = document.getElementById('promo-input-final').value.trim();
		const resultDiv = document.getElementById('promo-result-final');
		const finalPriceElement = document.getElementById('final-price');

		if (!code) {
			// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
			promoCode = '';
			finalPrice = originalPrice;
			resultDiv.innerHTML = '';
			finalPriceElement.textContent = `${originalPrice} ‚ÇΩ`;
			return;
		}

		try {
			const res = await fetch('/api/validate-promo/', {
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify({
					promo_code: code,
					procedure_id: {{ selected_procedure.id|default:"0" }}
				})
			});
			const data = await res.json();

			if (data.valid) {
				promoCode = code;
				finalPrice = parseFloat(data.new_price);
				resultDiv.innerHTML = `
					–°–∫–∏–¥–∫–∞ ${data.discount_percent}%.<br>
				`;
				finalPriceElement.textContent = `${data.new_price} ‚ÇΩ`;
			} else {
				promoCode = '';
				finalPrice = originalPrice;
				resultDiv.innerHTML = `<span style="color:red">${data.error}</span>`;
				finalPriceElement.textContent = `${originalPrice} ‚ÇΩ`;
			}
		} catch (error) {
			resultDiv.innerHTML = '<span style="color:red">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</span>';
			finalPriceElement.textContent = `${originalPrice} ‚ÇΩ`;
		}
	}

	// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
	document.getElementById('promo-input-final').addEventListener('input', function() {
		clearTimeout(this.debounceTimer);
		this.debounceTimer = setTimeout(checkPromoFinal, 500);
	});

	// –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
	$(document).ready(function() {
		$('input[name="phone"]').on('input', function() {
			let value = $(this).val().replace(/\D/g, '');
			if (value.length > 0) {
				if (value[0] !== '7' && value[0] !== '8') {
					value = '7' + value;
				}
				let formatted = '+7';
				if (value.length > 1) {
					formatted += ' (' + value.substring(1, 4);
				}
				if (value.length > 4) {
					formatted += ') ' + value.substring(4, 7);
				}
				if (value.length > 7) {
					formatted += '-' + value.substring(7, 9);
				}
				if (value.length > 9) {
					formatted += '-' + value.substring(9, 11);
				}
				$(this).val(formatted);
			}
		});

		// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—ã
		$('form').on('submit', function(e) {
			const phone = $('input[name="phone"]').val();
			const name = $('input[name="customer_name"]').val();
			const privacy = $('#privacyPolicy').is(':checked');

			if (!name || name.trim().length < 2) {
				alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)');
				e.preventDefault();
				return false;
			}

			if (!phone || !phone.match(/^\+7\s?\(\d{3}\)\s?\d{3}-\d{2}-\d{2}$/)) {
				alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (999) 999-99-99');
				e.preventDefault();
				return false;
			}

			if (!privacy) {
				alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
				e.preventDefault();
				return false;
			}

			// –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–º–æ–∫–æ–¥ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤ —Ñ–æ—Ä–º—É
			$('<input>').attr({
				type: 'hidden',
				name: 'promo_code_final',
				value: promoCode
			}).appendTo(this);

			$('<input>').attr({
				type: 'hidden',
				name: 'final_price',
				value: finalPrice
			}).appendTo(this);

			// –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∞–¥–µ—Ä
			$(this).find('button[type="submit"]')
				.html('‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...')
				.prop('disabled', true);
		});
	});
	</script>
</body>
</html>